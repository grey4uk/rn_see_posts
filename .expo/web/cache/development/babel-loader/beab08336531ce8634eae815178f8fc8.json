{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"C:\\\\Users\\\\1\\\\Documents\\\\goit_hw\\\\REACT\\\\native_project\\\\global_project\\\\screens\\\\Authentification\\\\AuthScreen.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useEffect } from \"react\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport View from \"react-native-web/dist/exports/View\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport TouchableWithoutFeedback from \"react-native-web/dist/exports/TouchableWithoutFeedback\";\nimport KeyboardAvoidingView from \"react-native-web/dist/exports/KeyboardAvoidingView\";\nimport Platform from \"react-native-web/dist/exports/Platform\";\nimport Keyboard from \"react-native-web/dist/exports/Keyboard\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport ImageBackground from \"react-native-web/dist/exports/ImageBackground\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport { auth, storage } from \"../../firebase/config\";\nimport * as ImagePicker from \"expo-image-picker\";\nimport * as Permissions from \"expo-permissions\";\nimport { useDispatch } from \"react-redux\";\nvar initialState = {\n  email: \"\",\n  password: \"\",\n  displayName: \"\"\n};\nexport var AuthScreen = function AuthScreen() {\n  var _useState = useState(initialState),\n      _useState2 = _slicedToArray(_useState, 2),\n      state = _useState2[0],\n      setState = _useState2[1];\n\n  var _useState3 = useState(null),\n      _useState4 = _slicedToArray(_useState3, 2),\n      message = _useState4[0],\n      setmessage = _useState4[1];\n\n  var _useState5 = useState(true),\n      _useState6 = _slicedToArray(_useState5, 2),\n      isRegister = _useState6[0],\n      setIsRegister = _useState6[1];\n\n  var _useState7 = useState(\"\"),\n      _useState8 = _slicedToArray(_useState7, 2),\n      avatar = _useState8[0],\n      setAvatar = _useState8[1];\n\n  var dispatch = useDispatch();\n\n  var currentUser = function currentUser() {\n    var currentUser;\n    return _regeneratorRuntime.async(function currentUser$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return _regeneratorRuntime.awrap(auth.currentUser);\n\n          case 2:\n            currentUser = _context.sent;\n            dispatch({\n              type: \"CURRENT_USER\",\n              payload: {\n                userName: currentUser.displayName,\n                userId: currentUser.uid,\n                avatar: currentUser.photoURL\n              }\n            });\n\n          case 4:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  useEffect(function () {\n    getPermissionAsync();\n  }, []);\n\n  var getPermissionAsync = function getPermissionAsync() {\n    var _await$Permissions$as, status;\n\n    return _regeneratorRuntime.async(function getPermissionAsync$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return _regeneratorRuntime.awrap(Permissions.askAsync(Permissions.CAMERA_ROLL));\n\n          case 2:\n            _await$Permissions$as = _context2.sent;\n            status = _await$Permissions$as.status;\n\n            if (status !== \"granted\") {\n              alert(\"Sorry, we need camera roll permissions to make this work!\");\n            }\n\n          case 5:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var takePhoto = function takePhoto() {\n    var result;\n    return _regeneratorRuntime.async(function takePhoto$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.next = 2;\n            return _regeneratorRuntime.awrap(ImagePicker.launchImageLibraryAsync({\n              mediaTypes: ImagePicker.MediaTypeOptions.All,\n              allowsEditing: true,\n              aspect: [4, 3],\n              quality: 1\n            }));\n\n          case 2:\n            result = _context3.sent;\n            setAvatar(result.uri);\n\n          case 4:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var uploadAvatar = function uploadAvatar(photo) {\n    var response, file, uniqueId, url;\n    return _regeneratorRuntime.async(function uploadAvatar$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            if (!photo) {\n              _context4.next = 16;\n              break;\n            }\n\n            _context4.next = 3;\n            return _regeneratorRuntime.awrap(fetch(photo));\n\n          case 3:\n            response = _context4.sent;\n            _context4.next = 6;\n            return _regeneratorRuntime.awrap(response.blob());\n\n          case 6:\n            file = _context4.sent;\n            uniqueId = Date.now().toString();\n            _context4.next = 10;\n            return _regeneratorRuntime.awrap(storage.ref(\"avatar/\" + uniqueId).put(file));\n\n          case 10:\n            _context4.next = 12;\n            return _regeneratorRuntime.awrap(storage.ref(\"avatar\").child(uniqueId).getDownloadURL());\n\n          case 12:\n            url = _context4.sent;\n            return _context4.abrupt(\"return\", url);\n\n          case 16:\n            uploadAvatar(\"../../assets/images/top-black-avatar.jpg\");\n\n          case 17:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var registerUser = function registerUser() {\n    var email, password, displayName, user, convertedAvatar;\n    return _regeneratorRuntime.async(function registerUser$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            Keyboard.dismiss();\n            email = state.email, password = state.password, displayName = state.displayName;\n            _context5.prev = 2;\n            _context5.next = 5;\n            return _regeneratorRuntime.awrap(auth.createUserWithEmailAndPassword(email, password));\n\n          case 5:\n            user = _context5.sent;\n            _context5.next = 8;\n            return _regeneratorRuntime.awrap(uploadAvatar(avatar));\n\n          case 8:\n            convertedAvatar = _context5.sent;\n            _context5.next = 11;\n            return _regeneratorRuntime.awrap(user.user.updateProfile({\n              displayName: displayName,\n              photoURL: convertedAvatar\n            }));\n\n          case 11:\n            _context5.next = 16;\n            break;\n\n          case 13:\n            _context5.prev = 13;\n            _context5.t0 = _context5[\"catch\"](2);\n            setmessage(_context5.t0.message);\n\n          case 16:\n            ;\n            currentUser();\n\n          case 18:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, null, null, [[2, 13]], Promise);\n  };\n\n  var loginUser = function loginUser() {\n    var email, password;\n    return _regeneratorRuntime.async(function loginUser$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            Keyboard.dismiss();\n            email = state.email, password = state.password;\n            _context6.prev = 2;\n            _context6.next = 5;\n            return _regeneratorRuntime.awrap(auth.signInWithEmailAndPassword(email, password));\n\n          case 5:\n            _context6.next = 10;\n            break;\n\n          case 7:\n            _context6.prev = 7;\n            _context6.t0 = _context6[\"catch\"](2);\n            setmessage(_context6.t0.message);\n\n          case 10:\n            setState(initialState);\n\n          case 11:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, null, null, [[2, 7]], Promise);\n  };\n\n  return React.createElement(TouchableWithoutFeedback, {\n    onPress: Keyboard.dismiss,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 5\n    }\n  }, React.createElement(ImageBackground, {\n    source: require(\"../../assets/images/road.jpg\" || \"https://picua.org/images/2020/04/20/b0bee066d47e2e7afa2078d8df52c728.jpg\"),\n    style: styles.image,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 7\n    }\n  }, React.createElement(KeyboardAvoidingView, {\n    behavior: Platform.Os == \"ios\" ? \"padding\" : \"height\",\n    style: styles.container,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 9\n    }\n  }, React.createElement(View, {\n    style: styles.form,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 11\n    }\n  }, !isRegister && React.createElement(TouchableOpacity, {\n    onPress: takePhoto,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 15\n    }\n  }, React.createElement(Image, {\n    style: {\n      width: 100,\n      height: 100,\n      borderRadius: 50,\n      marginBottom: 30\n    },\n    source: {\n      uri: avatar ? avatar : \"../../assets/images/top-black-avatar.jpg\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 17\n    }\n  })), !isRegister && React.createElement(TextInput, {\n    style: _objectSpread({}, styles.input, {\n      marginBottom: 20\n    }),\n    placeholder: \"enter nickname\",\n    value: state.displayName,\n    onFocus: function onFocus() {\n      return setmessage(null);\n    },\n    onChangeText: function onChangeText(value) {\n      return setState(_objectSpread({}, state, {\n        displayName: value\n      }));\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 15\n    }\n  }), React.createElement(TextInput, {\n    style: _objectSpread({}, styles.input, {\n      marginBottom: 20\n    }),\n    placeholder: \"enter email\",\n    value: state.email,\n    onFocus: function onFocus() {\n      return setmessage(null);\n    },\n    onChangeText: function onChangeText(value) {\n      return setState(_objectSpread({}, state, {\n        email: value\n      }));\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 13\n    }\n  }), React.createElement(TextInput, {\n    style: styles.input,\n    placeholder: \"enter password\",\n    secureTextEntry: true,\n    onChangeText: function onChangeText(value) {\n      return setState(_objectSpread({}, state, {\n        password: value\n      }));\n    },\n    value: state.password,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 13\n    }\n  }), message && React.createElement(Text, {\n    style: styles.inputError,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 25\n    }\n  }, message), React.createElement(TouchableOpacity, {\n    style: styles.btn,\n    onPress: isRegister ? loginUser : registerUser,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 13\n    }\n  }, React.createElement(Text, {\n    style: styles.btnTitle,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 15\n    }\n  }, \"Submit\")), React.createElement(View, {\n    style: styles.btnBlock,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 13\n    }\n  }, React.createElement(TouchableOpacity, {\n    style: styles.btn,\n    onPress: isRegister ? function () {\n      return setIsRegister(false);\n    } : function () {\n      return setIsRegister(true);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 15\n    }\n  }, React.createElement(Text, {\n    style: styles.btnTitle,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 17\n    }\n  }, !isRegister ? \"go Login\" : \"go Register\")))))));\n};\nvar styles = StyleSheet.create({\n  container: {\n    alignItems: \"center\",\n    justifyContent: \"center\"\n  },\n  image: {\n    flex: 1,\n    resizeMode: \"cover\",\n    justifyContent: \"center\",\n    width: \"100%\"\n  },\n  form: {\n    alignItems: \"center\"\n  },\n  input: {\n    borderColor: \"#556b2f\",\n    borderWidth: 2,\n    borderRadius: 18,\n    width: 300,\n    height: 40,\n    paddingLeft: 40,\n    backgroundColor: \"white\"\n  },\n  inputError: {\n    color: \"#f00\"\n  },\n  btnBlock: {\n    flexDirection: \"row\"\n  },\n  btn: {\n    height: 40,\n    width: 100,\n    backgroundColor: \"#556b2f\",\n    borderRadius: 18,\n    marginTop: 40,\n    justifyContent: \"center\",\n    alignItems: \"center\"\n  },\n  btnTitle: {\n    color: \"white\",\n    fontSize: 18\n  }\n});","map":{"version":3,"sources":["C:/Users/1/Documents/goit_hw/REACT/native_project/global_project/screens/Authentification/AuthScreen.js"],"names":["React","useState","useEffect","auth","storage","ImagePicker","Permissions","useDispatch","initialState","email","password","displayName","AuthScreen","state","setState","message","setmessage","isRegister","setIsRegister","avatar","setAvatar","dispatch","currentUser","type","payload","userName","userId","uid","photoURL","getPermissionAsync","askAsync","CAMERA_ROLL","status","alert","takePhoto","launchImageLibraryAsync","mediaTypes","MediaTypeOptions","All","allowsEditing","aspect","quality","result","uri","uploadAvatar","photo","fetch","response","blob","file","uniqueId","Date","now","toString","ref","put","child","getDownloadURL","url","registerUser","Keyboard","dismiss","createUserWithEmailAndPassword","user","convertedAvatar","updateProfile","loginUser","signInWithEmailAndPassword","require","styles","image","Platform","Os","container","form","width","height","borderRadius","marginBottom","input","value","inputError","btn","btnTitle","btnBlock","StyleSheet","create","alignItems","justifyContent","flex","resizeMode","borderColor","borderWidth","paddingLeft","backgroundColor","color","flexDirection","marginTop","fontSize"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport {\n  StyleSheet,\n  View,\n  TextInput,\n  TouchableWithoutFeedback,\n  KeyboardAvoidingView,\n  Platform,\n  Keyboard,\n  Image,\n  ImageBackground,\n  TouchableOpacity,\n  Text,\n} from \"react-native\";\nimport { auth, storage } from \"../../firebase/config\";\nimport * as ImagePicker from \"expo-image-picker\";\nimport * as Permissions from \"expo-permissions\";\nimport { useDispatch } from \"react-redux\";\n\nconst initialState = {\n  email: \"\",\n  password: \"\",\n  displayName: \"\",\n};\n\nexport const AuthScreen = () => {\n  const [state, setState] = useState(initialState);\n  const [message, setmessage] = useState(null);\n  const [isRegister, setIsRegister] = useState(true);\n  const [avatar, setAvatar] = useState(\"\");\n  const dispatch=useDispatch();\n\n  const currentUser = async () => {\n    const currentUser = await auth.currentUser;\n    dispatch({\n      type: \"CURRENT_USER\",\n      payload: {\n        userName: currentUser.displayName,\n        userId: currentUser.uid,\n        avatar: currentUser.photoURL,\n      },\n    });\n  };\n\n  useEffect(() => {\n    getPermissionAsync();\n  }, []);\n\n  const getPermissionAsync = async () => {\n    const { status } = await Permissions.askAsync(Permissions.CAMERA_ROLL);\n    if (status !== \"granted\") {\n      alert(\"Sorry, we need camera roll permissions to make this work!\");\n    }\n  };\n\n  const takePhoto = async () => {\n    let result = await ImagePicker.launchImageLibraryAsync({\n      mediaTypes: ImagePicker.MediaTypeOptions.All,\n      allowsEditing: true,\n      aspect: [4, 3],\n      quality: 1,\n    });\n    setAvatar(result.uri);\n  };\n\n  const uploadAvatar = async (photo) => {\n    if (photo) {\n      const response = await fetch(photo);\n      const file = await response.blob();\n      const uniqueId = Date.now().toString();\n      await storage.ref(`avatar/${uniqueId}`).put(file);\n      const url = await storage.ref(\"avatar\").child(uniqueId).getDownloadURL();\n      return url;\n    }\n    else uploadAvatar(\"../../assets/images/top-black-avatar.jpg\");\n  };\n\n  const registerUser = async () => {\n    Keyboard.dismiss();\n    const { email, password, displayName, } = state;\n    try {\n      const user = await auth.createUserWithEmailAndPassword(email, password);\n      const convertedAvatar=await uploadAvatar(avatar);\n      await user.user.updateProfile({\n        displayName: displayName,\n        photoURL: convertedAvatar,\n      });\n      // await  loginUser();\n    } catch (error) {\n      setmessage(error.message);\n    };\n    currentUser(); \n  };\n\n  const loginUser = async () => {\n    Keyboard.dismiss();\n    const { email, password } = state;\n    try {\n       await auth.signInWithEmailAndPassword(email, password);\n    } catch (error) {\n      setmessage(error.message);\n    }\n    setState(initialState);\n  };\n\n  return (\n    <TouchableWithoutFeedback onPress={Keyboard.dismiss}>\n      \n      <ImageBackground\n        source={require(\"../../assets/images/road.jpg\"||\"https://picua.org/images/2020/04/20/b0bee066d47e2e7afa2078d8df52c728.jpg\")}\n        style={styles.image}\n      >\n        <KeyboardAvoidingView\n          behavior={Platform.Os == \"ios\" ? \"padding\" : \"height\"}\n          style={styles.container}\n        >\n          <View style={styles.form}>\n            {!isRegister && (\n              <TouchableOpacity onPress={takePhoto}>\n                <Image\n                  style={{\n                    width: 100,\n                    height: 100,\n                    borderRadius: 50,\n                    marginBottom: 30,\n                  }}\n                  source={{\n                    uri: avatar\n                      ? avatar\n                      : \"../../assets/images/top-black-avatar.jpg\",\n                  }}\n                />\n              </TouchableOpacity>\n            )}\n            {!isRegister && (\n              <TextInput\n                style={{ ...styles.input, marginBottom: 20 }}\n                placeholder=\"enter nickname\"\n                value={state.displayName}\n                onFocus={() => setmessage(null)}\n                onChangeText={(value) =>\n                  setState({ ...state, displayName: value })\n                }\n              />\n            )}\n            <TextInput\n              style={{ ...styles.input, marginBottom: 20 }}\n              placeholder=\"enter email\"\n              value={state.email}\n              onFocus={() => setmessage(null)}\n              onChangeText={(value) => setState({ ...state, email: value })}\n            />\n            <TextInput\n              style={styles.input}\n              placeholder=\"enter password\"\n              secureTextEntry={true}\n              onChangeText={(value) => setState({ ...state, password: value })}\n              value={state.password}\n            />\n            {message && <Text style={styles.inputError}>{message}</Text>}\n            <TouchableOpacity\n              style={styles.btn}\n              onPress={isRegister ? loginUser : registerUser}\n            >\n              <Text style={styles.btnTitle}>Submit</Text>\n            </TouchableOpacity>\n            <View style={styles.btnBlock}>\n              <TouchableOpacity\n                style={styles.btn}\n                onPress={\n                  isRegister\n                    ? () => setIsRegister(false)\n                    : () => setIsRegister(true)\n                }\n              >\n                <Text style={styles.btnTitle}>\n                  {!isRegister ? \"go Login\" : \"go Register\"}\n                </Text>\n              </TouchableOpacity>\n            </View>\n          </View>\n        </KeyboardAvoidingView>\n      </ImageBackground>\n    </TouchableWithoutFeedback>\n  );\n};\n\nconst styles = StyleSheet.create({\n  container: {\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  image: {\n    flex: 1,\n    resizeMode: \"cover\",\n    justifyContent: \"center\",\n    width: \"100%\",\n  },\n  form: {\n    alignItems: \"center\",\n  },\n  input: {\n    borderColor: \"#556b2f\",\n    borderWidth: 2,\n    borderRadius: 18,\n    width: 300,\n    height: 40,\n    paddingLeft: 40,\n    backgroundColor: \"white\",\n  },\n  inputError: { color: \"#f00\" },\n  btnBlock: {\n    flexDirection: \"row\",\n  },\n  btn: {\n    height: 40,\n    width: 100,\n    backgroundColor: \"#556b2f\",\n    borderRadius: 18,\n    marginTop: 40,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n  btnTitle: {\n    color: \"white\",\n    fontSize: 18,\n  },\n});\n"]},"metadata":{},"sourceType":"module"}